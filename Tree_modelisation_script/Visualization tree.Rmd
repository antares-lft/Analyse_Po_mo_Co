---
title: "Tree visualisation"
output: html_document
date: "2025-06-17"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
# Load required packages for tree manipulation and visualization
library(treeio)    # For reading phylogenetic trees with annotations
library(ggtree)    # For plotting and annotating phylogenetic trees
library(dplyr)     # For data manipulation

# Read the phylogenetic tree with NHX annotations from the specified file path
tree <- read.nhx("/home/alafitte/Internship/Rapport de stage/Arbre/bat_genes_complete_filtered-PhyML_tree.nhx")

# Display the data table associated with each node in the tree
head(tree@data)

# Add a column to identify node types: 'External' for tips, 'Internal' for internal nodes
tree@data <- tree@data %>%
  mutate(type = ifelse(node <= length(tree@phylo$tip.label), "External", "Internal"))

# Visualize the phylogenetic tree using ggtree:
# - Color branches by the log10 of population size (W) for the first plot,
# - and color branches by node type ('External' or 'Internal') for the second plot.

# Plot 1: Tree colored by log10 of population size (W)
plot1 <- ggtree(tree, aes(color = log10(as.numeric(W)))) +  # Color branches by log10(W)
  geom_tiplab() +                                          # Add tip labels (species names)
  scale_color_viridis_c(option = "plasma") +               # Use viridis plasma color scale for clarity
  theme_tree2() +                                           # Use tree theme with axis lines
  ggtitle("Phylogenetic Tree Colored by log10(Population Size W)")

# Display plot 1
print(plot1)

# Plot 2: Tree colored by node type: internal (red) vs external tips (blue)
plot2 <- ggtree(tree, aes(color = type)) +                 # Color branches by node type
  geom_tiplab() +                                          # Add tip labels
  scale_color_manual(values = c("External" = "blue", "Internal" = "red")) +  # Manual color mapping
  theme_tree2() +                                           # Tree theme with axis lines
  ggtitle("Internal (Red) vs External (Blue) Branches")

# Display plot 2
print(plot2)

```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
